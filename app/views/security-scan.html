<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Security Scanner - Age Verification</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      min-height: 100vh;
      padding: 20px;
      color: #fff;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    .header {
      background: rgba(0, 0, 0, 0.3);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .header p {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.8);
    }

    .scanner-container {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      margin-bottom: 20px;
    }

    #reader {
      border-radius: 8px;
      overflow: hidden;
      background: #000;
    }

    .status {
      background: rgba(0, 0, 0, 0.3);
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      text-align: center;
      font-size: 14px;
    }

    .status.scanning {
      background: rgba(255, 193, 7, 0.3);
      color: #ffc107;
    }

    .status.success {
      background: rgba(76, 175, 80, 0.3);
      color: #4caf50;
    }

    .status.error {
      background: rgba(244, 67, 54, 0.3);
      color: #f44336;
    }

    .result-container {
      display: none;
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      color: #333;
    }

    .result-container.show {
      display: block;
    }

    .success-badge {
      background: #4caf50;
      color: white;
      padding: 15px 25px;
      border-radius: 50px;
      display: inline-block;
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 20px;
    }

    .success-badge::before {
      content: "‚úì ";
      font-size: 20px;
    }

    .error-badge {
      background: #f44336;
      color: white;
      padding: 15px 25px;
      border-radius: 50px;
      display: inline-block;
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 20px;
    }

    .error-badge::before {
      content: "‚úï ";
      font-size: 20px;
    }

    .warning-badge {
      background: #ff9800;
      color: white;
      padding: 15px 25px;
      border-radius: 50px;
      display: inline-block;
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 20px;
    }

    .warning-badge::before {
      content: "‚ö† ";
      font-size: 20px;
    }

    .error-message {
      background: #ffebee;
      color: #c62828;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 4px solid #f44336;
    }

    .error-message h3 {
      margin: 0 0 10px 0;
      font-size: 18px;
    }

    .error-message p {
      margin: 0;
      color: #666;
    }

    .result-success,
    .result-error {
      display: none;
    }

    .result-success.show,
    .result-error.show {
      display: block;
    }

    .check-info {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }

    .check-info h3 {
      color: #1e3c72;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    .check-info .value {
      font-size: 24px;
      font-weight: 600;
      color: #333;
    }

    .photo-container {
      margin: 20px 0;
      text-align: center;
    }

    .photo-container img {
      width: 200px;
      height: 200px;
      object-fit: cover;
      border-radius: 10px;
      border: 3px solid #e0e0e0;
    }

    .photo-container h3 {
      color: #1e3c72;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 15px;
    }

    .buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .btn {
      flex: 1;
      padding: 15px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #1e3c72;
      color: white;
    }

    .btn-primary:hover {
      background: #2a5298;
    }

    .btn-secondary {
      background: #e0e0e0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #d0d0d0;
    }

    .code-display {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      word-break: break-all;
      color: #666;
    }

    @media (max-width: 640px) {
      .header h1 {
        font-size: 20px;
      }

      .result-container {
        padding: 20px;
      }

      .buttons {
        flex-direction: column;
      }

      .success-badge,
      .error-badge,
      .warning-badge {
        font-size: 16px;
        padding: 12px 20px;
      }

      .error-message h3 {
        font-size: 16px;
      }

      .check-info .value {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üîí Security Scanner</h1>
      <p>Age Verification System</p>
    </div>

    <div class="scanner-container">
      <div id="reader"></div>
      <div class="status scanning" id="status">
        üì∑ Camera active - Position QR code in view
      </div>
    </div>

    <div class="result-container" id="result">
      <!-- Success Result -->
      <div class="result-success" id="result-success">
        <div class="success-badge">Code Checked Successfully</div>
        
        <div class="check-info">
          <h3>Type of Check</h3>
          <div class="value" id="check-type">Over 18</div>
        </div>

        <div class="photo-container">
          <h3>Identity Photo</h3>
          <img id="identity-photo" src="" alt="Identity Photo">
        </div>

        <div class="check-info">
          <h3>Verification Time</h3>
          <div class="value" id="verify-time"></div>
        </div>
      </div>

      <!-- Error Result -->
      <div class="result-error" id="result-error">
        <div id="error-badge-container"></div>
        
        <div class="error-message" id="error-details">
          <h3 id="error-title"></h3>
          <p id="error-description"></p>
        </div>

        <div class="check-info">
          <h3>Scan Time</h3>
          <div class="value" id="scan-time"></div>
        </div>
      </div>

      <div class="buttons">
        <button class="btn btn-primary" onclick="scanAnother()">Scan Another</button>
        <button class="btn btn-secondary" onclick="window.location.href='/'">Exit</button>
      </div>
    </div>
  </div>

  <!-- HTML5 QR Code Scanner Library -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>

  <script>
    let html5QrCode;
    let isScanning = true;

    // Array of random photos
    const photos = [
      'https://thumbs.dreamstime.com/b/photo-document-passport-id-mature-caucasian-man-suit-white-shirt-126121929.jpg',
      'https://media.istockphoto.com/id/1473852991/photo/biometric-passport-photo-of-attractive-female-natural-look-healthy-skin.jpg?s=612x612&w=0&k=20&c=vGm_gpAC8CNFqbQm5AzxUMrLJZRbqj4xq_QiGiPRqtY=',
      'https://thumbs.dreamstime.com/b/passport-picture-cool-guy-blue-shirt-isolated-white-background-cut-out-55127029.jpg'
    ];

    // Error states configuration
    const errorStates = {
      expired: {
        badge: 'warning-badge',
        badgeText: 'Code Expired',
        title: 'This code has expired',
        description: 'The temporary identity code was valid but has now expired. Please request a new code from the user.'
      },
      invalid: {
        badge: 'error-badge',
        badgeText: 'Invalid Code',
        title: 'Code not recognized',
        description: 'This code is not valid. It may have been entered incorrectly or does not exist in our system.'
      },
      unavailable: {
        badge: 'error-badge',
        badgeText: 'Service Unavailable',
        title: 'Identity verification service unavailable',
        description: 'We are unable to verify this identity at the moment. Please request alternative identification from the user.'
      }
    };

    function onScanSuccess(decodedText, decodedResult) {
      if (!isScanning) return;
      
      isScanning = false;
      
      // Stop the scanner
      html5QrCode.stop().then(() => {
        // Hide scanner, show results
        document.querySelector('.scanner-container').style.display = 'none';
        document.getElementById('result').classList.add('show');
        
        // Randomly decide between success and error (60% success, 40% error)
        const random = Math.random();
        const now = new Date();
        const timeString = now.toLocaleString('en-GB', {
          day: 'numeric',
          month: 'long',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit'
        });
        
        if (random < 0.6) {
          // Success state (60%)
          showSuccess(timeString);
        } else if (random < 0.75) {
          // Expired error (15%)
          showError('expired', timeString);
        } else if (random < 0.9) {
          // Invalid error (15%)
          showError('invalid', timeString);
        } else {
          // Service unavailable (10%)
          showError('unavailable', timeString);
        }
      }).catch(err => {
        console.error('Error stopping scanner:', err);
      });
    }

    function showSuccess(timeString) {
      document.getElementById('result-success').classList.add('show');
      document.getElementById('result-error').classList.remove('show');
      
      // Select random photo
      const randomPhoto = photos[Math.floor(Math.random() * photos.length)];
      document.getElementById('identity-photo').src = randomPhoto;
      
      // Display verification time
      document.getElementById('verify-time').textContent = timeString;
      
      // Play success sound (optional)
      try {
        const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZUQ0PVqzn77BdGAg+ltryxm8lBSuAzvLaiTkIGWe77eeaTRAMUKfj8LZjHAY5kdfyy3ksBSV3x/DdkEALFGG06OuoVRQKRp/g8r5sIQUxh9Hz04IzBh5uwO/jmVEND1as5++wXRgIPpbb8sZvJQYrf9Dy2Ik5CBtmvO3nmk0RDFCo4/C2YhwGOZHX8sp5LQUld8fw3ZBAC0hgterqp1UUCkef4O+/bSEFMYnR89OCMwYfb8Dv45lRDQ9WrOfvsFkYBz2W2/HGbiUG');
        audio.play();
      } catch(e) {}
    }

    function showError(errorType, timeString) {
      document.getElementById('result-success').classList.remove('show');
      document.getElementById('result-error').classList.add('show');
      
      const error = errorStates[errorType];
      
      // Set error badge
      const badgeHtml = `<div class="${error.badge}">${error.badgeText}</div>`;
      document.getElementById('error-badge-container').innerHTML = badgeHtml;
      
      // Set error details
      document.getElementById('error-title').textContent = error.title;
      document.getElementById('error-description').textContent = error.description;
      
      // Display scan time
      document.getElementById('scan-time').textContent = timeString;
      
      // Play error sound (optional)
      try {
        const audio = new Audio('data:audio/wav;base64,UklGRl4AAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YToAAACAf4B/gICAgIGBgYKCg4OEhYWGh4iJiouMjY6PkJGSk5SVlpeYmZqbnJ2en6ChoqOkpaanqKmqq6ytrq+wsQ==');
        audio.play();
      } catch(e) {}
    }

    function onScanFailure(error) {
      // Silently handle scan failures (these happen continuously while scanning)
    }

    function scanAnother() {
      isScanning = true;
      document.querySelector('.scanner-container').style.display = 'block';
      document.getElementById('result').classList.remove('show');
      
      // Hide both success and error states
      document.getElementById('result-success').classList.remove('show');
      document.getElementById('result-error').classList.remove('show');
      
      // Restart scanner
      startScanner();
    }

    function startScanner() {
      html5QrCode = new Html5Qrcode("reader");
      
      const config = {
        fps: 10,
        qrbox: { width: 250, height: 250 },
        aspectRatio: 1.0
      };

      // Start scanning with back camera (preferred on mobile)
      html5QrCode.start(
        { facingMode: "environment" }, // Use back camera
        config,
        onScanSuccess,
        onScanFailure
      ).catch(err => {
        // If back camera fails, try front camera
        html5QrCode.start(
          { facingMode: "user" },
          config,
          onScanSuccess,
          onScanFailure
        ).catch(err => {
          document.getElementById('status').textContent = '‚ùå Unable to access camera. Please grant camera permissions.';
          document.getElementById('status').className = 'status error';
        });
      });
    }

    // Start scanner when page loads
    window.addEventListener('load', function() {
      startScanner();
    });

    // Clean up on page unload
    window.addEventListener('beforeunload', function() {
      if (html5QrCode) {
        html5QrCode.stop();
      }
    });
  </script>
</body>
</html>

